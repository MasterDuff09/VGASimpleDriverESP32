#include "vga_handler.h"


static uint16_t last_delay = 0;
uint16_t write_on_y = 0;

const unsigned char Font8x8Pixels[] = {
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 33: '!'
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 34: '"'
0, 0, 28, 0, 28, 0, 0, 0, 
0, 0, 28, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 35: '//'
0, 0, 28, 0, 28, 0, 0, 0, 
0, 0, 28, 0, 28, 0, 0, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 28, 0, 28, 0, 0, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 28, 0, 28, 0, 0, 0, 
0, 0, 28, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 36: '$'
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 28, 28, 0, 0, 0, 
0, 0, 28, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 28, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
// Carattere 37: '%'
0, 28, 28, 0, 28, 0, 0, 0, 
0, 28, 28, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 28, 28, 0, 0, 
0, 0, 28, 0, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 38: '&'
0, 0, 28, 28, 0, 0, 0, 0, 
0, 28, 0, 0, 28, 0, 0, 0, 
0, 0, 28, 28, 0, 0, 0, 0, 
0, 28, 0, 0, 28, 0, 0, 0, 
0, 28, 0, 0, 28, 0, 0, 0, 
0, 28, 0, 0, 28, 0, 0, 0, 
0, 0, 28, 28, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 39: '''
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 40: '('
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 41: ')'
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 42: '28'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 43: '+'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 44: ','
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
// Carattere 45: '-'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 46: '.'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 47: '/'
0, 0, 0, 0, 0, 0, 28, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 48: '0'
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 28, 28, 0, 0, 
0, 28, 0, 28, 0, 28, 0, 0, 
0, 28, 28, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 49: '28'
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 50: '2'
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 51: '3'
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 52: '4'
0, 0, 0, 0, 28, 28, 0, 0, 
0, 0, 0, 28, 0, 28, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 53: '5'
0, 28, 28, 28, 28, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 54: '6'
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 55: '7'
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 56: '8'
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 57: '9'
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 28, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 58: ':'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 59: ';'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 60: '<'
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 61: '='
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 62: '>'
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 63: '?'
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 64: '@'
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 28, 28, 28, 0, 0, 
0, 28, 0, 28, 0, 28, 0, 0, 
0, 28, 0, 28, 28, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 65: 'A'
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 66: 'B'
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 67: 'C'
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 28, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 28, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 68: 'D'
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 69: 'E'
0, 28, 28, 28, 28, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 70: 'F'
0, 28, 28, 28, 28, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 71: 'G'
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 28, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 28, 28, 28, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 72: 'H'
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 73: 'I'
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 74: 'J'
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 75: 'K'
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 28, 0, 0, 0, 
0, 28, 0, 28, 0, 0, 0, 0, 
0, 28, 28, 0, 0, 0, 0, 0, 
0, 28, 0, 28, 0, 0, 0, 0, 
0, 28, 0, 0, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 76: 'L'
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 77: 'M'
0, 28, 0, 0, 0, 0, 0, 28, 
0, 28, 28, 0, 0, 0, 28, 28, 
0, 28, 0, 28, 0, 28, 0, 28, 
0, 28, 0, 0, 28, 0, 0, 28, 
0, 28, 0, 0, 0, 0, 0, 28, 
0, 28, 0, 0, 0, 0, 0, 28, 
0, 28, 0, 0, 0, 0, 0, 28, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 78: 'N'
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 28, 0, 0, 0, 28, 0, 
0, 28, 0, 28, 0, 0, 28, 0, 
0, 28, 0, 0, 28, 0, 28, 0, 
0, 28, 0, 0, 0, 28, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 79: 'O'
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 80: 'P'
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 81: 'Q'
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 28, 0, 28, 0, 0, 
0, 28, 0, 0, 28, 28, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 82: 'R'
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 28, 0, 0, 0, 0, 
0, 28, 0, 0, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 83: 'S'
0, 0, 28, 28, 28, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 84: 'T'
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 85: 'U'
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 86: 'V'
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 87: 'W'
0, 28, 0, 0, 0, 0, 0, 28,
0, 28, 0, 0, 0, 0, 0, 28, 
0, 28, 0, 0, 0, 0, 0, 28, 
0, 28, 0, 0, 28, 0, 0, 28, 
0, 28, 0, 28, 0, 28, 0, 28, 
0, 28, 28, 0, 0, 0, 28, 28, 
0, 28, 0, 0, 0, 0, 0, 28, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 88: 'X'
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 89: 'Y'
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 90: 'Z'
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 91: '['
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 92: '\'
28, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 93: ']'
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 94: '^'
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 0, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 95: '_'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
28, 28, 28, 28, 28, 28, 28, 28, 
// Carattere 96: '`'
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 97: 'a'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 28, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 98: 'b'
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 28, 28, 0, 0, 0, 
0, 28, 28, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 99: 'c'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 0, 0, 28, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 100: 'd'
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 28, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 101: 'e'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 102: 'f'
0, 0, 0, 0, 28, 28, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 103: 'g'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 0, 0, 0, 
// Carattere 104: 'h'
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 28, 28, 0, 0, 0, 
0, 28, 28, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 105: 'i'
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 106: 'j'
0, 0, 0, 0, 0, 28, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 28, 28, 0, 
0, 0, 0, 0, 0, 28, 28, 0, 
0, 0, 0, 0, 0, 28, 28, 0, 
0, 0, 0, 0, 0, 28, 28, 0, 
0, 0, 28, 0, 0, 28, 28, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
// Carattere 107: 'k'
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 28, 0, 0, 0, 
0, 28, 0, 28, 0, 0, 0, 0, 
0, 28, 28, 0, 0, 0, 0, 0, 
0, 28, 0, 28, 0, 0, 0, 0, 
0, 28, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 108: 'l'
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 109: 'm'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 0, 28, 28, 0, 0, 
0, 28, 0, 28, 0, 0, 28, 0, 
0, 28, 0, 28, 0, 0, 28, 0, 
0, 28, 0, 28, 0, 0, 28, 0, 
0, 28, 0, 28, 0, 0, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 110: 'n'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 111: 'o'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 28, 0, 0, 0, 28, 0, 
0, 0, 28, 0, 0, 0, 28, 0, 
0, 0, 28, 0, 0, 0, 28, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 112: 'p'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 28, 28, 28, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
// Carattere 113: 'q'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
// Carattere 114: 'r'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 28, 28, 0, 0, 0, 
0, 28, 28, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 115: 's'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 28, 28, 0, 
0, 0, 28, 0, 0, 0, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 28, 0, 
0, 28, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 116: 't'
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 28, 0, 
0, 0, 0, 0, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 117: 'u'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 28, 28, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 118: 'v'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 119: 'w'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 0, 28,
0, 28, 0, 0, 0, 0, 0, 28, 
0, 28, 0, 0, 28, 0, 0, 28, 
0, 28, 0, 28, 0, 28, 0, 28, 
0, 0, 28, 0, 0, 0, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 120: 'x'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 121: 'y'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 28, 0, 0, 0, 0, 28, 0, 
0, 0, 28, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
// Carattere 122: 'z'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 28, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 28, 28, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 123: '{'
0, 0, 0, 0, 28, 28, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 28, 28, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 28, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 124: '|'
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 28, 28, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 125: '}'
0, 0, 28, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 28, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 0, 0, 28, 0, 0, 0, 
0, 0, 28, 28, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 126: '~'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 28, 0, 28, 0, 28, 0, 
0, 28, 0, 28, 0, 28, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
// Carattere 127: 'DEL'
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0,};

static uint8_t ch_lut[TOTAL_CH][CHAR_H][CHAR_W] __attribute__((aligned(4)));
static uint8_t screen[V_ACTIVE_FRAMES / 8][H_ACTIVE_FRAMES / 8];

static inline bool is_visible(uint16_t y){
    return (y < V_ACTIVE_FRAMES);
}

static inline bool is_vsync(uint16_t y){
    return (y >= (V_ACTIVE_FRAMES + V_FRONT_PORCH_FRAMES)) && (y < (V_ACTIVE_FRAMES + V_FRONT_PORCH_FRAMES + V_SYNC_PULSE_FRAMES));
}

static void build_lut(void){
    for (int ci = 0; ci < TOTAL_CH; ++ci){
        for(int cy = 0; cy < CHAR_H; ++cy){
            for(int cx = 0; cx < CHAR_W; ++cx){
                ch_lut[ci][cy][cx] = Font8x8Pixels[(ci*CHAR_H + cy)*CHAR_W + cx];
            }
        }
    }
}

static void clear_screen(void){
    for (uint8_t i = 0; i < V_ACTIVE_FRAMES / 8; i++){
        for (uint8_t j = 0; j < H_ACTIVE_FRAMES / 8; j++){
            screen[i][j] = ' ';
        }
    }
}

static void update_screen(void){
    uint8_t i = 0;
    for (; i < H_ACTIVE_FRAMES / 8; i++){
        screen[write_on_y][i] = ' ';
    }
    i = 0;
    while (msg[i] != '\0'){
        if (msg[i] == '\r') break; 
        screen[write_on_y][i] = msg[i];
        i++;
    }
    write_on_y = (write_on_y + 1) % (V_ACTIVE_FRAMES / 8);
    
}

static void render_line(uint16_t y, uint8_t* dest){
    uint16_t row_y = y / CHAR_H;
    uint16_t line_pixel_y = y % CHAR_H;

    uint16_t line_pixel_x = 0;

    for (uint8_t row_x = 0; row_x < H_ACTIVE_FRAMES / 8; row_x++){

        uint8_t ch = screen[row_y][row_x];
        if (ch < FIRST_CH || ch >= FIRST_CH + TOTAL_CH){
            ch = ' ';
        }
        const uint8_t ci = (uint8_t)(ch - FIRST_CH);

        for (uint8_t pix_char_x = 0; pix_char_x < 8; pix_char_x++){
            dest[line_pixel_x] = (ch_lut[ci][line_pixel_y][pix_char_x]) | H_HIGH_V_HIGH;
            line_pixel_x++;
        }
    }
}


void main_vga_task(void *arg){
    
    build_lut();
    clear_screen();

    uint8_t update_pending = false;
    while (true){

        if (xSemaphoreTake(msg_ready, 0) == pdTRUE){
            update_screen();
            update_pending = true;
        }

        if (update_pending){
            if (xSemaphoreTake(display_done, 0) == pdTRUE){
                xSemaphoreGive(uart_send_avail);
                update_pending = false;
            } else {
                xSemaphoreTake(display_done, 0);
            }
            
        }
        xSemaphoreTake(line_ready, portMAX_DELAY);


        //uint16_t next_line = (current_y_line + 1) % 525;
        uint16_t next_line_2 = (current_y_line + 1) % TOTAL_V_FRAMES;

        
        
        uint8_t *dest = (uint8_t*) fill_next;

        if (is_visible(next_line_2)){ //&& len > 0){

            //render_char(next_line_fill, dst);
            render_line(next_line_2, dest);


        } else {

            //memset(dest, is_vsync(next_line_2)? H_HIGH_V_LOW : H_HIGH_V_HIGH, H_ACTIVE_FRAMES);
            memcpy(dest, is_vsync(next_line_2)? black_lineL : black_lineH, H_ACTIVE_FRAMES);

        }
        /*
        if (++last_delay >= 512){
            last_delay = 0;
            vTaskDelay(0);
        }
        */
    }
}

void vga_start(void){

    init_sem();
    start_buffer_i2s();
    uart_start();
    //xTaskCreatePinnedToCore(screen_update_task, "screen_update", 4096, NULL, 10, NULL, 1);
    xTaskCreatePinnedToCore(main_vga_task, "render", 4096, NULL, 10, NULL, 0);
    //AO
    i2s_start();
    
    
}